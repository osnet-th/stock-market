# Phase: μ£Όμ‹ κ±°λ λ‚΄μ—­ κ΄€λ¦¬

## π“‹ 1. κ°μ”

μ‚¬μ©μκ°€ μ™Έλ¶€μ—μ„ κ±°λν• μ£Όμ‹μ λ§¤μ/λ§¤λ„ λ‚΄μ—­μ„ κΈ°λ΅ν•κ³  κ΄€λ¦¬ν•λ” κΈ°λ¥μ„ κµ¬ν„ν•©λ‹λ‹¤.
ν„μ¬ μ£Όμ‹ κ°€κ²©κ³Ό λΉ„κµν•μ—¬ μμµλ¥ μ„ κ³„μ‚°ν•κ³ , ν¬νΈν΄λ¦¬μ¤ ν„ν™©μ„ μ΅°νν•  μ μμµλ‹λ‹¤.

---

## π― 2. κΈ°λ¥ μ”κµ¬μ‚¬ν•­

### 2.1 λ§¤μ κΈ°λ΅ κ΄€λ¦¬
- λ§¤μ κΈ°λ΅ λ“±λ΅ (μ£Όμ‹ μ½”λ“, λ§¤μκ°€, μλ‰, λ§¤μμΌ)
- λ§¤μ κΈ°λ΅ μμ •
- λ§¤μ κΈ°λ΅ μ‚­μ 
- μ‚¬μ©μλ³„ λ§¤μ λ‚΄μ—­ μ΅°ν
- μ£Όμ‹λ³„ λ§¤μ λ‚΄μ—­ μ΅°ν

### 2.2 λ§¤λ„ κΈ°λ΅ κ΄€λ¦¬
- λ§¤λ„ κΈ°λ΅ λ“±λ΅ (μ£Όμ‹ μ½”λ“, λ§¤λ„κ°€, μλ‰, λ§¤λ„μΌ)
- λ§¤λ„ κΈ°λ΅ μμ •
- λ§¤λ„ κΈ°λ΅ μ‚­μ 
- μ‚¬μ©μλ³„ λ§¤λ„ λ‚΄μ—­ μ΅°ν
- μ£Όμ‹λ³„ λ§¤λ„ λ‚΄μ—­ μ΅°ν

### 2.3 ν¬νΈν΄λ¦¬μ¤ μ΅°ν
- λ³΄μ  μ£Όμ‹ λ©λ΅ μ΅°ν
- μ£Όμ‹λ³„ ν‰κ·  λ§¤μκ°€ κ³„μ‚°
- μ£Όμ‹λ³„ λ³΄μ  μλ‰ κ³„μ‚°
- μ£Όμ‹λ³„ μ΄ ν¬μ κΈμ•΅ κ³„μ‚°

### 2.4 μμµλ¥  κ³„μ‚°
- ν„μ¬κ°€ μ΅°ν (μ£Όμ‹ API μ—°λ™)
- λ―Έμ‹¤ν„ μ†μµ κ³„μ‚° (λ³΄μ  μ£Όμ‹ λ€μƒ)
- μ‹¤ν„ μ†μµ κ³„μ‚° (λ§¤λ„ μ™„λ£ μ£Όμ‹ λ€μƒ)
- μμµλ¥  κ³„μ‚° (λ°±λ¶„μ¨)
- μ΄ μμµλ¥  μ”μ•½

---

## π—οΈ 3. λ„λ©”μΈ λ¨λΈ μ„¤κ³„

### 3.1 StockTransaction (μ£Όμ‹ κ±°λ)
**ν•µμ‹¬ μ†μ„±:**
- id: κ±°λ ID
- userId: μ‚¬μ©μ ID (ID κΈ°λ° μ°Έμ΅°)
- stockCode: μ£Όμ‹ μ½”λ“
- transactionType: κ±°λ μ ν• (BUY, SELL)
- price: κ±°λ λ‹¨κ°€
- quantity: κ±°λ μλ‰
- transactionDate: κ±°λμΌ
- createdAt: μƒμ„±μΌμ‹
- updatedAt: μμ •μΌμ‹

**ν•µμ‹¬ λΉ„μ¦λ‹μ¤ κ·μΉ™:**
- κ±°λ λ‹¨κ°€λ” μ–‘μμ—¬μ•Ό ν•¨
- κ±°λ μλ‰μ€ μ–‘μμ—¬μ•Ό ν•¨
- κ±°λμΌμ€ λ―Έλ λ‚ μ§μΌ μ μ—†μ
- λ§¤λ„ μλ‰μ€ λ³΄μ  μλ‰μ„ μ΄κ³Όν•  μ μ—†μ

**λ„λ©”μΈ λ©”μ„λ“:**
- calculateTotalAmount(): κ±°λ μ΄μ•΅ κ³„μ‚° (λ‹¨κ°€ Γ— μλ‰)
- isBuy(): λ§¤μ κ±°λ μ—¬λ¶€ ν™•μΈ
- isSell(): λ§¤λ„ κ±°λ μ—¬λ¶€ ν™•μΈ
- validate(): κ±°λ μ ν¨μ„± κ²€μ¦

### 3.2 Portfolio (ν¬νΈν΄λ¦¬μ¤)
**ν•µμ‹¬ μ†μ„±:**
- stockCode: μ£Όμ‹ μ½”λ“
- totalQuantity: μ΄ λ³΄μ  μλ‰ (λ§¤μ - λ§¤λ„)
- averagePrice: ν‰κ·  λ§¤μκ°€
- totalInvestment: μ΄ ν¬μ κΈμ•΅

**ν•µμ‹¬ λΉ„μ¦λ‹μ¤ κ·μΉ™:**
- λ³΄μ  μλ‰μ΄ 0 μ΄ν•μΈ κ²½μ° ν¬νΈν΄λ¦¬μ¤μ—μ„ μ μ™Έ
- ν‰κ·  λ§¤μκ°€λ” κ°€μ¤‘ ν‰κ· μΌλ΅ κ³„μ‚°
- μ΄ ν¬μ κΈμ•΅μ€ λ§¤μ μ΄μ•΅ - λ§¤λ„ μ΄μ•΅

**λ„λ©”μΈ λ©”μ„λ“:**
- calculateUnrealizedProfitLoss(currentPrice): λ―Έμ‹¤ν„ μ†μµ κ³„μ‚°
- calculateRateOfReturn(currentPrice): μμµλ¥  κ³„μ‚°
- isEmpty(): λ³΄μ  μλ‰ 0 μ—¬λ¶€ ν™•μΈ

### 3.3 ProfitLoss (μ†μµ)
**ν•µμ‹¬ μ†μ„±:**
- stockCode: μ£Όμ‹ μ½”λ“
- realizedProfitLoss: μ‹¤ν„ μ†μµ
- unrealizedProfitLoss: λ―Έμ‹¤ν„ μ†μµ
- totalProfitLoss: μ΄ μ†μµ
- rateOfReturn: μμµλ¥ 

**λ„λ©”μΈ λ©”μ„λ“:**
- calculateTotalProfitLoss(): μ΄ μ†μµ κ³„μ‚°
- isProfit(): μμµ μ—¬λ¶€ ν™•μΈ
- isLoss(): μ†μ‹¤ μ—¬λ¶€ ν™•μΈ

---

## π’Ύ 4. λ°μ΄ν„°λ² μ΄μ¤ μ„¤κ³„

### 4.1 stock_transactions ν…μ΄λΈ”
- id: BIGINT (PK, AUTO_INCREMENT)
- user_id: BIGINT (NOT NULL, μ‚¬μ©μ ID μ°Έμ΅°)
- stock_code: VARCHAR(20) (NOT NULL, μ£Όμ‹ μ½”λ“)
- transaction_type: VARCHAR(10) (NOT NULL, BUY/SELL)
- price: DECIMAL(15, 2) (NOT NULL, κ±°λ λ‹¨κ°€)
- quantity: INT (NOT NULL, κ±°λ μλ‰)
- transaction_date: DATE (NOT NULL, κ±°λμΌ)
- created_at: TIMESTAMP (NOT NULL, μƒμ„±μΌμ‹)
- updated_at: TIMESTAMP (NOT NULL, μμ •μΌμ‹)

**μΈλ±μ¤:**
- idx_user_stock: (user_id, stock_code) - μ‚¬μ©μλ³„ μ£Όμ‹ μ΅°ν μµμ ν™”
- idx_transaction_date: (transaction_date) - λ‚ μ§λ³„ μ΅°ν μµμ ν™”

---

## π” 5. API μ„¤κ³„

### 5.1 κ±°λ λ‚΄μ—­ API
**POST /api/transactions**
- λ§¤μ/λ§¤λ„ κΈ°λ΅ λ“±λ΅
- Request: stockCode, transactionType, price, quantity, transactionDate
- Response: μƒμ„±λ κ±°λ ID

**GET /api/transactions**
- μ‚¬μ©μλ³„ μ „μ²΄ κ±°λ λ‚΄μ—­ μ΅°ν
- Query Params: page, size, sort
- Response: νμ΄μ§•λ κ±°λ λ‚΄μ—­ λ©λ΅

**GET /api/transactions/{id}**
- νΉμ • κ±°λ λ‚΄μ—­ μƒμ„Έ μ΅°ν
- Response: κ±°λ μƒμ„Έ μ •λ³΄

**PUT /api/transactions/{id}**
- κ±°λ λ‚΄μ—­ μμ •
- Request: price, quantity, transactionDate
- Response: μμ •λ κ±°λ μ •λ³΄

**DELETE /api/transactions/{id}**
- κ±°λ λ‚΄μ—­ μ‚­μ 
- Response: 204 No Content

### 5.2 ν¬νΈν΄λ¦¬μ¤ API
**GET /api/portfolio**
- μ‚¬μ©μ ν¬νΈν΄λ¦¬μ¤ μ΅°ν
- Response: λ³΄μ  μ£Όμ‹ λ©λ΅ (μ£Όμ‹ μ½”λ“, ν‰κ·  λ§¤μκ°€, λ³΄μ  μλ‰, μ΄ ν¬μκΈ)

**GET /api/portfolio/{stockCode}**
- νΉμ • μ£Όμ‹ ν¬νΈν΄λ¦¬μ¤ μƒμ„Έ μ΅°ν
- Response: μ£Όμ‹λ³„ λ§¤μ/λ§¤λ„ λ‚΄μ—­, ν‰κ·  λ§¤μκ°€, λ³΄μ  μλ‰

### 5.3 μμµλ¥  API
**GET /api/portfolio/profit-loss**
- μ „μ²΄ ν¬νΈν΄λ¦¬μ¤ μ†μµ μ΅°ν
- Response: μ£Όμ‹λ³„ μ‹¤ν„/λ―Έμ‹¤ν„ μ†μµ, μμµλ¥ 

**GET /api/portfolio/{stockCode}/profit-loss**
- νΉμ • μ£Όμ‹ μ†μµ μ΅°ν
- Response: μ‹¤ν„/λ―Έμ‹¤ν„ μ†μµ, μμµλ¥ , ν„μ¬κ°€

---

## π§ 6. κµ¬ν„ μμ„ (TDD)

### Step 1: Domain κ³„μΈµ κµ¬ν„
**1.1 TransactionType Enum**
- BUY, SELL νƒ€μ… μ •μ
- ν…μ¤νΈ: νƒ€μ…λ³„ κ°’ κ²€μ¦

**1.2 StockTransaction λ„λ©”μΈ λ¨λΈ**
- ν…μ¤νΈ: κ±°λ μƒμ„± (μ ν¨ν• κ°’)
- ν…μ¤νΈ: κ±°λ μƒμ„± μ‹¤ν¨ (μμ λ‹¨κ°€)
- ν…μ¤νΈ: κ±°λ μƒμ„± μ‹¤ν¨ (μμ μλ‰)
- ν…μ¤νΈ: κ±°λ μƒμ„± μ‹¤ν¨ (λ―Έλ λ‚ μ§)
- ν…μ¤νΈ: κ±°λ μ΄μ•΅ κ³„μ‚°
- ν…μ¤νΈ: λ§¤μ/λ§¤λ„ μ—¬λ¶€ ν™•μΈ
- κµ¬ν„: μµμ† κµ¬ν„ λ° λ¦¬ν©ν† λ§

**1.3 Portfolio λ„λ©”μΈ λ¨λΈ**
- ν…μ¤νΈ: ν¬νΈν΄λ¦¬μ¤ μƒμ„± (λ§¤μ λ‚΄μ—­ κΈ°λ°)
- ν…μ¤νΈ: ν‰κ·  λ§¤μκ°€ κ³„μ‚° (λ‹¨μΌ λ§¤μ)
- ν…μ¤νΈ: ν‰κ·  λ§¤μκ°€ κ³„μ‚° (μ—¬λ¬ λ§¤μ)
- ν…μ¤νΈ: λ³΄μ  μλ‰ κ³„μ‚° (λ§¤μ-λ§¤λ„)
- ν…μ¤νΈ: λ―Έμ‹¤ν„ μ†μµ κ³„μ‚°
- ν…μ¤νΈ: μμµλ¥  κ³„μ‚°
- κµ¬ν„: μµμ† κµ¬ν„ λ° λ¦¬ν©ν† λ§

**1.4 ProfitLoss λ„λ©”μΈ λ¨λΈ**
- ν…μ¤νΈ: μ†μµ μƒμ„±
- ν…μ¤νΈ: μ΄ μ†μµ κ³„μ‚°
- ν…μ¤νΈ: μμµ/μ†μ‹¤ μ—¬λ¶€ ν™•μΈ
- κµ¬ν„: μµμ† κµ¬ν„ λ° λ¦¬ν©ν† λ§

### Step 2: Infrastructure κ³„μΈµ κµ¬ν„
**2.1 StockTransactionEntity**
- ν…μ¤νΈ: Entity μƒμ„± λ° ν•„λ“ κ²€μ¦
- ν…μ¤νΈ: toModel() λ³€ν™
- κµ¬ν„: Entity λ° λ³€ν™ λ΅μ§

**2.2 StockTransactionJpaRepository**
- μΈν„°νμ΄μ¤ μ •μ (Spring Data JPA)
- μ»¤μ¤ν…€ μΏΌλ¦¬ λ©”μ„λ“ μ •μ

**2.3 StockTransactionRepositoryImpl**
- ν…μ¤νΈ: κ±°λ μ €μ¥
- ν…μ¤νΈ: κ±°λ μ΅°ν (ID)
- ν…μ¤νΈ: μ‚¬μ©μλ³„ κ±°λ μ΅°ν
- ν…μ¤νΈ: μ£Όμ‹λ³„ κ±°λ μ΅°ν
- ν…μ¤νΈ: κ±°λ μ‚­μ 
- κµ¬ν„: μ €μ¥μ† κµ¬ν„ (Mock Repository)

### Step 3: Application κ³„μΈµ κµ¬ν„
**3.1 StockTransactionService**
- ν…μ¤νΈ: κ±°λ λ“±λ΅ (μ ν¨ν• μ…λ ¥)
- ν…μ¤νΈ: κ±°λ λ“±λ΅ μ‹¤ν¨ (μλ»λ μ…λ ¥)
- ν…μ¤νΈ: κ±°λ μμ •
- ν…μ¤νΈ: κ±°λ μ‚­μ 
- ν…μ¤νΈ: κ±°λ μ΅°ν
- κµ¬ν„: Service κµ¬ν„ (Mock Repository)

**3.2 PortfolioService**
- ν…μ¤νΈ: ν¬νΈν΄λ¦¬μ¤ μ΅°ν (λ‹¨μΌ μ£Όμ‹)
- ν…μ¤νΈ: ν¬νΈν΄λ¦¬μ¤ μ΅°ν (μ—¬λ¬ μ£Όμ‹)
- ν…μ¤νΈ: ν¬νΈν΄λ¦¬μ¤ μ΅°ν (κ±°λ λ‚΄μ—­ μ—†μ)
- ν…μ¤νΈ: ν‰κ·  λ§¤μκ°€ κ³„μ‚°
- ν…μ¤νΈ: λ³΄μ  μλ‰ κ³„μ‚°
- κµ¬ν„: Service κµ¬ν„ (Mock Repository, Mock StockPriceService)

**3.3 ProfitLossService**
- ν…μ¤νΈ: μ†μµ κ³„μ‚° (λ―Έμ‹¤ν„)
- ν…μ¤νΈ: μ†μµ κ³„μ‚° (μ‹¤ν„)
- ν…μ¤νΈ: μμµλ¥  κ³„μ‚°
- ν…μ¤νΈ: μ „μ²΄ μ†μµ μ”μ•½
- κµ¬ν„: Service κµ¬ν„ (Mock PortfolioService, Mock StockPriceService)

### Step 4: Presentation κ³„μΈµ κµ¬ν„
**4.1 StockTransactionController**
- ν…μ¤νΈ: POST /api/transactions
- ν…μ¤νΈ: GET /api/transactions
- ν…μ¤νΈ: GET /api/transactions/{id}
- ν…μ¤νΈ: PUT /api/transactions/{id}
- ν…μ¤νΈ: DELETE /api/transactions/{id}
- κµ¬ν„: Controller κµ¬ν„ (Mock Service)

**4.2 PortfolioController**
- ν…μ¤νΈ: GET /api/portfolio
- ν…μ¤νΈ: GET /api/portfolio/{stockCode}
- κµ¬ν„: Controller κµ¬ν„ (Mock Service)

**4.3 ProfitLossController**
- ν…μ¤νΈ: GET /api/portfolio/profit-loss
- ν…μ¤νΈ: GET /api/portfolio/{stockCode}/profit-loss
- κµ¬ν„: Controller κµ¬ν„ (Mock Service)

### Step 5: ν†µν•© λ° μ™Έλ¶€ μ—°λ™
**5.1 μ£Όμ‹ API μ—°λ™**
- StockPriceServiceμ™€ ν†µν•©
- ν„μ¬κ°€ μ΅°ν κΈ°λ¥ ν™μ©
- ν…μ¤νΈ: μμµλ¥  κ³„μ‚° μ‹ μ‹¤μ  μ£Όμ‹ κ°€κ²© μ΅°ν

**5.2 μΈμ¦ μ—°λ™**
- JWT μΈμ¦ μ μ©
- μ‚¬μ©μλ³„ κ±°λ λ‚΄μ—­ μ ‘κ·Ό μ μ–΄
- ν…μ¤νΈ: κ¶ν• κ²€μ¦

---

## β οΈ 7. μ£Όμ” κ³ λ ¤μ‚¬ν•­

### 7.1 λΉ„μ¦λ‹μ¤ κ·μΉ™
- **λ§¤λ„ μ μ•½**: λ§¤λ„ μλ‰μ΄ λ³΄μ  μλ‰μ„ μ΄κ³Όν•  μ μ—†μ
- **ν‰κ·  λ§¤μκ°€ κ³„μ‚°**: κ°€μ¤‘ ν‰κ·  λ°©μ‹ μ‚¬μ©
- **μ‹¤ν„ μ†μµ**: FIFO(μ„ μ…μ„ μ¶) λ°©μ‹μΌλ΅ κ³„μ‚°
- **ν¬νΈν΄λ¦¬μ¤ μ μ™Έ**: λ³΄μ  μλ‰μ΄ 0μΈ μ£Όμ‹μ€ ν¬νΈν΄λ¦¬μ¤μ—μ„ μ μ™Έ

### 7.2 μ„±λ¥ μµμ ν™”
- **μΈλ±μ¤ ν™μ©**: user_id, stock_code λ³µν•© μΈλ±μ¤λ΅ μ΅°ν μ„±λ¥ ν–¥μƒ
- **μΊμ‹±**: ν¬νΈν΄λ¦¬μ¤ μ΅°ν κ²°κ³Ό μΊμ‹± (TTL: 5λ¶„)
- **λ°°μΉ μ΅°ν**: μ£Όμ‹ κ°€κ²© μ΅°ν μ‹ λ°°μΉ μ²λ¦¬

### 7.3 λ°μ΄ν„° μ •ν•©μ„±
- **νΈλμ­μ… κ²½κ³„**: κ±°λ λ“±λ΅/μμ •/μ‚­μ λ” λ‹¨μΌ νΈλμ­μ… λ‚΄μ—μ„ μ²λ¦¬
- **λ™μ‹μ„± μ μ–΄**: λ‚™κ΄€μ  λ½ μ μ© (version ν•„λ“)
- **κ²€μ¦ λ΅μ§**: Domain κ³„μΈµμ—μ„ μ ν¨μ„± κ²€μ¦

### 7.4 μ™Έλ¶€ μμ΅΄μ„±
- **μ£Όμ‹ κ°€κ²© μ΅°ν**: StockPriceServiceμ— μμ΅΄
- **API μ¥μ•  μ²λ¦¬**: μ£Όμ‹ κ°€κ²© μ΅°ν μ‹¤ν¨ μ‹ μΊμ‹λ κ°’ μ‚¬μ© λλ” μ—λ¬ μ‘λ‹µ

### 7.5 ν™•μ¥μ„±
- **λ‹¤μ–‘ν• μ£Όμ‹ μ‹μ¥ μ§€μ›**: κµ­λ‚΄/ν•΄μ™Έ μ£Όμ‹ μ½”λ“ κµ¬λ¶„
- **ν†µν™” μ²λ¦¬**: ν–¥ν›„ ν™μ¨ μ μ© κ³ λ ¤
- **λ°°λ‹ΉκΈ κΈ°λ΅**: μ¶”κ°€ ν•„λ“ ν™•μ¥ κ°€λ¥μ„±

---

**μ‘μ„±μΌ**: 2026-01-20